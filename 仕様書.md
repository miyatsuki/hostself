# AI-assisted Code Modification Tool 仕様書

## 概要

このツールは、AIを用いてコードリポジトリの問題を自動で解析し、修正を提案・適用します。ローカルモードとリモートモードの両方で動作し、指定された問題を分析して修正コードを生成します。

## 主要機能

1. コードリポジトリの解析
2. 問題の自動検出
3. AIを使用した修正案の生成
4. 修正の適用
5. テストの実行と検証

## システム構成

### 主要コンポーネント

- **main.py:** ツールのメインロジックを含みます。問題の解析、修正コードの生成、ファイルのマージおよびテストを行います。
- **README.md:** ツールの概要、インストール方法、使用方法を説明します。
- **requirements.txt:** 必要なPythonライブラリをリストアップし、pipでインストール可能にします。
- **tests/test_main.py:** ユニットテストを含み、`list_files`関数の動作検証を行います。
- **.ai/config.toml:** テスト実行コマンドなど、ツールの設定を定義します。
- **.vscode/settings.json:** Pythonの型チェックモードを設定します。

### 依存関係

- langchain
- langchain-anthropic
- langchain-community
- openai
- python-dotenv

## 機能詳細

### ファイル操作

- `list_files()`: リポジトリ内のファイルをリストアップし、無視設定に従ってフィルタリングします。
- `write_files()`: 修正されたファイルをディスクに書き込みます。

### AI修正プロセス

- `fix_files_claude()`: Claude AIモデルを使用した修正を行います。
- `fix_files_openai()`: OpenAI GPT-4モデルを使用した修正を行います。
- `fix_files_merge()`: 複数の修正案をマージします。

### テスト実行

- `test()`: 設定ファイルに基づいてテストスイートを実行し、修正後のコードを検証します。

## 使用方法

- コマンドラインから次のように実行します：
  ```
  python main.py <issue_file>
  ```
  - `<issue_file>`には修正すべき問題の説明を含むファイルを指定します。

## テスト仕様

- Git管理されたファイルが正しく取得できることを確認するテスト
- .ai/config.tomlで指定されたignoreファイルが除外されることを確認するテスト

## 設定

.ai/config.tomlファイルを使用して、以下の設定が可能です：

- ignore: 無視するファイルのリスト
- tests: 実行するテストコマンドのリスト

## エラーハンドリング

- ファイル読み込み時のUnicodeDecodeErrorをキャッチし、該当ファイルをスキップ
- テスト失敗時は修正プロセスを継続

## セキュリティ考慮事項

- OpenAI APIキーは.envファイルで管理
- センシティブな情報はGit管理下に置かない

## 将来の拡張性

- 追加のAIモデルのサポート
- より詳細な問題分析機能
- ユーザーインターフェースの改善
